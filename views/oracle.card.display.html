<?php
$title = 'Oracle Description';
include('./views/page.header.html');
?>

<!--Module de son : -->
<script src="lib/RecordRTC.js"></script>


<!--Popup Overlay -->
<div id="facebox">
	<div class="content">
		<div style="padding:5px;">
		<h2><?php echo $lang['warning']; ?></h2><br/><h3><?php echo $lang['cut_sound']; ?></h3> 
		<button class="close" onclick="menu()" style="cursor: pointer; background:#000; color:white; text-align:center; font-weight:bold; position:absolute; bottom:20%; left:50%; padding:0 2px; width:200px; height:30px; line-height:20px">OK</button>
		<div class="resume">&nbsp;</div>
		</div>
	</div>
</div>
<!-- Fin Popup -->
<div id="main-container">
	<div id="userid" data-userid="<?php echo $this->oracle; ?>" style="display:none"></div>
	<div id="userlang" data-userlang="<?php echo $this->userlang; ?>" style="display:none"></div>
	<div id="cardid" data-cardid="<?php echo $this->res['carteID']; ?>" style="display:none"></div>
	<div id="levelcard" data-levelcard="<?php echo $this->res['nivcarte']; ?>" style="display:none"></div>
	<div id="jrForm">
		<div id="firstPage">
			<?php if ( $this->errors ) { ?>
			<fieldset class="errors">
				<legend>Erreurs</legend>
					<ul>
					<?php foreach ( $this->errors as $error ) { ?>
						<li>
							<?php echo $error; ?>
						</li>
					<?php } ?>
					</ul>
				<?php } ?>
			</fieldset>
				<div id="descr" style="font-family:Playball;font-style: normal;">
					<legend class="form-jr-heading" style="text-align:center; font-style:bold;"><?php echo $lang['rules']; ?></legend>
					<dl style="font-size:20px; padding:10px;">
							<?php echo $lang['description']; ?>
							<?php echo $lang['beware_time']; ?>
					</dl>
				</div><br/>
					<center><table>
						<tr>
							<td><img src="style/default.css/imgs/recGris.png" alt="Recording" id="recD"></td>
							<td><button class="btn btn-primary btn-lg btn-block" id="record" type="button" style="margin-left:10px;" ><?php echo $lang['record']; ?></button></td>
						</tr>
					</table><center>
		</div>						   					
	 <div class="form-jr" role="form" id="description.carte"> <!-- action="./index.php?mode=oracle.result" -->
			
			<div id="secondPage">
	                                <p class="form-jr-heading" style="text-align:center; font-style:bold;"><?php echo $lang['card_description']; ?></p>
					<div id='card'></div>
					<center><table>
					<tr> <th id="countdown" class="timer">
						</th>
					</tr>
					</table></center> 	
					<img src="style/default.css/imgs/recON.png" alt="Recording" id="rec" style="float:left;margin-left:30%">
					<button type="button" id='restart' title="restart recording"  class="btn btn-default"><img src="style/default.css/imgs/restart.png" alt="restart" id="restart now" style="float:left;"></button>
					<button type="button"  id="valid" title = "send recording"  class="btn btn-default"><img src="style/default.css/imgs/valid.png" alt="valider" id="valider" style="float:left;"></button>
					<br/>				
			</div>			
			<div id="thirdPage">
						
						<dl>
							<p style="text-align:center;">
							<audio id="preview"></audio>
							</p>
							<hr/>
							<div id="container"></div>
						</dl>
						<dl> <p id="audiovide"></p></dl>
						<div id="form-cmd"style="visibility: hidden;text-align:center;" >
	               				      <button type="submit" class="btn btn-danger" id="abandon_form" 
	                                               name="abandon_form" title="Erase recording"><?php echo $lang['abandonner'];?></button>
					 		
							<button class="btn btn-success" type="submit" id="submit_form" title="Save recording" 
							 name="submit_form" style="margin-left:3%;"><?php echo $lang['validate'];?></button> 
						</div>
			</div>
		</div>
	</div>			
</div>

<!--
	ici rajouter un message d'erreur quand aucune carte n'existe dans la langue de l'utilisateur
-->
<audio class="audioDemo" controls preload="none" style="visibility:hidden;"> 
   <source src="audio/test.mp3" type="audio/mpeg">
</audio>

<script>
function menu(){
	document.location.href="index.php"
}

function init(){
	$("#secondPage").hide(0);
	$("#")


}

// JQUERY permettant d'afficher la bonne page selon l'action effectuée


$("#record").click(function() {
$("#firstPage").hide("slow");
});


$("#valid").click(function(){
	$("#secondPage").hide("slow");
	$("#thirdPage").show("slow");
});					   

//Indispensable si nous ne gardons pas l'enregistrement!
$("#abandon_form").click(function(){ 
deleteAudioVideoFiles();	
});




//Bouton Rec qui clignote					   
$("#rec").fadeOut(900).delay(500).fadeIn(900);								
			   

  
 






function hideRecButton(){
	if(document.getElementById("rec").style.visibility === "visible"){
		document.getElementById("rec").style.visibility="hidden";
	}
	else{
		document.getElementById("rec").style.visibility = "visible"
	}

}

function popUp(){
	 // Script pour le PopUp  l'ouverture de la page , prévenir l'utilisateur de couper le son
	$(document).ready(function() {
	// select the overlay element - and "make it an overlay"
	$("#facebox").overlay({

	// some mask tweaks suitable for facebox-looking dialogs
	mask: {
	// you might also consider a "transparent" color for the mask
	color: '#000000',
	// load mask a little faster
	loadSpeed: 1000,
	// very transparent
	opacity: 0.7
	},
	// disable this for modal dialog-type of overlays
	closeOnClick: true,
	// we want to use the programming API
	api: true

	// load it after delay
	})
	var ol = $("#facebox").overlay({api: true});
	// wait 20 seconds, then load the overlay
	setTimeout(function() {
	ol.load();
	}, 0);
	setTimeout(function() {
	ol.close();
	document.location.href="index.php"
	}, 10000);
	}); 
}

</script>

	
<?php
include('./views/page.footer.html');
?>
